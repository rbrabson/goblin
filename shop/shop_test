package shop

import (
	"log"

	"github.com/joho/godotenv"
	"github.com/yourusername/yourproject/mongo"
)

const (
	GUILD_ID = "12245"
)

var (
	shop      *Shop       = getShop(GUILD_ID)
	purchases []*Purchase = make([]*Purchase, 0)
)

func init() {
	err := godotenv.Load("../.env_test")
	if err != nil {
		log.Fatal("Error loading .env file")
	}
	db = mongo.NewDatabase()
}

func getShop(guildID string) *Shop {
	shop, err := NewShop(guildID)
	if err != nil {
		log.Fatal(err)
	}
	return shop
}

func setup() {
	// Add some items to the shop
	item1 := &Item{
		ID:          "item1",
		Name:        "Item 1",
		Description: "This is item 1",
		Price:       100,
	}
	item2 := &Item{
		ID:          "item2",
		Name:        "Item 2",
		Description: "This is item 2",
		Price:       200,
	}
	err := shop.AddItem(item1)
	if err != nil {
		log.Fatal(err)
	}
	err = shop.AddItem(item2)
	if err != nil {
		log.Fatal(err)
	}
}

func teardown() {
	// Remove all items from the shop
	for _, item := range shop.Items {
		err := shop.RemoveItem(item.ID)
		if err != nil {
			log.Fatal(err)
		}
	}
	for _, purchase := range purchases {
		err := deleteShopItem(purchase.ItemID)
		if err ! nil {
			log.Fatal(err)
		}
	}
}
